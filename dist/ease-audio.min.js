!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.EaseAudio=e():t.EaseAudio=e()}(window,function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var s=class{constructor(){this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.audioDom=new window.Audio,this.audio=this.audioCtx.createMediaElementSource(this.audioDom)}play(){}pause(){}stop(){}unload(){}seek(){}};var n=function(t){return!!t&&{edge:t.indexOf("Edge")>-1,trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&-1===t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile.*/)||!!t.match(/Mobile/g),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1,iPad:t.indexOf("iPad")>-1,webApp:-1===t.indexOf("Safari"),weixin:t.indexOf("MicroMessenger")>-1,weibo:t.indexOf("Weibo")>-1,facebook:t.indexOf("FBAN")>-1,twitter:t.indexOf("FBAN")>-1,qq:" qq"===t.match(/\sQQ/i),hmlyApp:/himalaya/i.test(t)}};let a;try{a=window&&window.navigator&&window.navigator.userAgent}catch(t){console.error(`[isIE]: ${t}`)}const o=!!a&&n(a).trident,h=(!!a&&n(a).edge,(t,e,i)=>{if(!window)return!1;const s=i||window;window.addEventListener?s.addEventListener(t,e,!1):s.attachEvent(`on${t}`,e)}),r=(t,e,i)=>{if(!window)return!1;const s=i||window;window.removeEventListener?s.removeEventListener(t,e,!1):s.detachEvent(`on${t}`,e)},l=t=>{if("object"!=typeof t)return typeof t;const e=Object.prototype.toString.call(t).length-1;return Object.prototype.toString.call(t).slice(8,e).toLowerCase()},d=["loading","playing","paused","stopped","ended","loaderror","playerror"],u=["list-once","list-random","list-loop","single-once","single-loop"],p=["onplay","onpause","onstop","onend","onload","oncanplay","onprogress","onvolume","onseeking","onseeked","onrate","ontimeupdate","onloaderror","onplayerror","oncut","onpick"],c=["detail","info","warn","error","silent"],y="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA";var f=class{constructor(t){this.isInit=!1,this.init=this.init.bind(this),this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.toggle=this.toggle.bind(this),this.cut=this.cut.bind(this),this.pick=this.pick.bind(this),this.load=this.load.bind(this),this.seek=this.seek.bind(this),this.rate=this.rate.bind(this),this.volume=this.volume.bind(this),this.muted=this.muted.bind(this),this.stop=this.stop.bind(this),this.unload=this.unload.bind(this),this.model=this.model.bind(this),this.on=this.on.bind(this),this.off=this.off.bind(this),this.once=this.once.bind(this),this.playlist=this.playlist.bind(this),this.init(t)}get duration(){return this.audioH5.duration}set setProps({prop:t,value:e}){this.audioH5[t]&&!this._checkType(this.audioH5[t],"function")&&(this.audioH5[t]=e,this._updateConfig({prop:e}))}init(t){if(!this.isInit&&t&&this._checkType(t,"object")&&"{}"!==JSON.stringify(t))return this._initial(t),this._registerEvent(t),this._returnParams()}play(){if(this._checkInit()){try{this._blockEvent({block:!1});let t=this.audioH5.play();if(t&&"undefined"!=typeof Promise&&(t instanceof Promise||"function"==typeof t.then)&&(this.playLocker=!0,t.then(()=>{this.lockQueue.forEach(t=>t&&t()),this.lockQueue.splice(0),this.playLocker=!1}).catch(t=>{this.lockQueue.splice(0),this.playLocker=!1,this._setPlayState(d[6]),this._fireEventQueue(t,"onplayerror")})),this.audioH5.paused){const t="Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.";this._setPlayState(d[6]),this._fireEventQueue(t,"onplayerror")}}catch(t){this._setPlayState(d[6]),this._fireEventQueue(t,"onplayerror")}return this.playId}}pause(){if(this._checkInit())return this._playLockQueue(()=>this.audioH5.pause()),this.playId}toggle(){if(this._checkInit()&&"stopped"!==this.playState&&"ended"!==this.playState&&"loaderror"!==this.playState&&"playerror"!==this.playState)return null===this.playState||"paused"===this.playState?this.play():this.pause(),this.playId}cut(){if(this._checkInit())return this._cut(),this._returnParams()}pick(t){if(this._checkInit()&&this._checkType(t,"number",!0)){for(let e=0;e<this.playList.length;e++)if(this.playList[e].playId===t){this.unload(),this._setPlayIndex(e);const t=this.playList[this.playIndex].src,i={...this.config,src:t};this._createAudio(i),this._registerEvent(i),this._fireEventQueue(this.playId,"onpick"),this.play();break}return this._returnParams()}}load(){if(this._checkInit())return this.audioH5.load(),this.playId}seek(t){if(this._checkInit()){if(!this._checkType(t,"number"))return this.audioH5.currentTime;{if(o&&!this.metaDataLoaded)return void(this.seekValue=t);const e=this.audioH5.duration;t>e&&(t=e),t<0&&(t=0),this.seekValue=null,this._playLockQueue(()=>this.audioH5.currentTime=t)}}}rate(t){if(this._checkInit()){if(!this._checkType(t,"number"))return this.audioH5.playbackRate;t>2&&(t=2),t<.5&&(t=.5),this._playLockQueue(()=>this.audioH5.playbackRate=t),this._updateConfig({rate:t})}}volume(t){if(this._checkInit()){if(!this._checkType(t,"number"))return this.audioH5.volume;t>1&&(t=1),t<0&&(t=0),this._playLockQueue(()=>{this.audioH5.muted=!1,this.audioH5.volume=t}),this._updateConfig({volume:t})}}muted(t){if(this._checkInit()){if(!this._checkType(t,"boolean",!0))return this.audioH5.muted;this._playLockQueue(()=>this.audioH5.muted=t),this._updateConfig({muted:t})}}stop(){if(this._checkInit()&&this.playState!==d[3])return this._blockEvent({block:!0}),this.audioH5.currentTime=0,this.audioH5.pause(),this._setPlayState(d[3]),this._fireEventQueue(this.playId,"onstop"),this.playId}unload(){this._checkInit()&&(this.stop(),this._unregisterEvent(),this.audioH5.src=y,this.audioH5=null,this.isInit=!1)}model(t){if(this._checkInit()){if(-1===u.indexOf(t))return this.playModel;this.playModel=t}}on(t,e){if(this._checkInit()&&this._checkType(t,"string",!0)&&this._checkType(e,"function",!0)){const i=0===t.indexOf("on")?t:`on${t}`;this._onEvent(i,e)}}off(t,e){if(this._checkInit()&&this._checkType(t,"string",!0)){const i=0===t.indexOf("on")?t:`on${t}`;this._offEvent(i,e)}}once(t,e){if(this._checkInit()&&this._checkType(t,"string",!0)&&this._checkType(e,"function",!0)){const i=0===t.indexOf("on")?t:`on${t}`,s=`EASE_AUDIO_${i.toUpperCase()}_ONCE_CALLBACK`,n=t=>{e&&e(t),this._offEvent(i,n,s)};this._onEvent(i,n,s)}}playlist(t){const{action:e,list:i,playId:s,params:n}=t;if(this._checkInit()&&this._checkType(e,"string",!0)&&(!i||this._checkType(i,"array",!0))&&(!s||this._checkType(s,"number",!0))&&(!n||this._checkType(n,"object",!0)))return this._handlePlayList(t),this._returnParams()}_initial(t){let e;if(this.config=t,this.playState=null,this.debug=t.debug||!1,this.logLevel=-1!==c.indexOf(t.logLevel)&&t.logLevel||c[3],this.idCounter=1e3,this.lockQueue=new Array(0),this.playLocker=!1,this.playId=1e3,this.playModel=-1!==u.indexOf(t.playModel)&&t.playModel||t.loop&&u[3]||u[0],this.playIndex=0,this.playList=new Array(0),this.buffered=new Array(0),this.eventController=new Array(0),this.eventMethods=Object.create(null),t.playlist&&this._checkType(t.playlist,"array")){for(let e=0;e<t.playlist.length;e++)this._checkType(t.playlist[e],"object")||(t.playlist[e]=Object.create(null,{src:{writable:!0,enumerable:!0,configurable:!0,value:t.playlist[e]}}));this._handlePlayList({action:"add",list:t.playlist}),(e=t.playlist[0]&&t.playlist[0].src)&&this._checkType(e,"string")||(e=y,this._logErr("The src property is necessary and must be string!"))}else this._logErr("Please pass correct playlist parameters!"),e=y;this._createAudio({...t,src:e})}_createAudio(t){this.isInit=!0,this.audioH5=new window.Audio,this.audioH5.autoplay=t.autoplay||!1,this.audioH5.loop=t.loop||!1,this.audioH5.src=this._srcAssemble(t.src),this.audioH5.preload=t.preload||!0,this.audioH5.volume=t.volume||(0===t.volume?0:1),this.audioH5.muted=t.muted||!1,this.audioH5.playbackRate=t.rate||t.playbackRate||1,this.audioH5.controls=!1}_srcAssemble(t){return t&&this._checkType(t,"string")?t:y}_updateConfig(t){this.config={...this.config,...t}}_returnParams(){return{playId:this.playId,playingData:this.playList[this.playIndex],playlist:this.playList}}_setPlayState(t){if(this._checkType(t,"string",!0)&&this.playState!==t){const e=this.audioH5.readyState>2,i=this.audioH5.paused,s=this.audioH5.ended,n=this.audioH5.seeking;switch(t){case d[0]:if(i||s||e)return!1;break;case d[1]:if(i||s||n||!e)return!1;break;case d[2]:if(s)return!1}return this._logInfo(`setPlayState - ${t}`),this.playState=t,this.playState}}_setPlayIndex(t){const e=this.playModel,i=this.playList.length-1;if(0===t)return this.playIndex=0,void(this.playId=this.playList[0]&&this.playList[0].playId||this.playId);switch(e){case"list-once":this.playIndex=t||(i>=this.playIndex?++this.playIndex:this.playIndex);break;case"list-random":this.playIndex=t||Math.round(Math.random()*i);break;case"list-loop":this.playIndex=t||(i>this.playIndex?++this.playIndex:0);break;case"single-once":case"single-loop":this.playIndex=t||this.playIndex;break;default:this.playIndex=t||this.playIndex}return this.playId=this.playList[this.playIndex]&&this.playList[this.playIndex].playId||this.playId,this._log(`setPlayIndex - playIndex: ${this.playIndex}  playId: ${this.playId}`),this.playIndex}_resetPlayList(){this.playList=[],this._setPlayIndex(0)}_handlePlayList({action:t,list:e,playId:i,params:s}){switch(t){case"add":this.playList=[...this.playList,...e.map(t=>{if(this._checkType(t,"object"))return t.playId=this.idCounter,this.idCounter++,t})];break;case"delete":if(i)for(let t=0;t<this.playList.length;t++)if(this.playList[t].playId===i)return this.playList.splice(t,1);break;case"insert":if(i&&e)for(let t=0;t<this.playList.length;t++)if(this.playList[t].playId===i)return this.playList.splice(t,0,...e.map(t=>(t.playId=this.idCounter,this.idCounter++,t)));break;case"replace":if(i&&e)for(let t=0;t<this.playList.length;t++)if(this.playList[t].playId===i)return this.playList.splice(t,1,...e.map(t=>(t.playId=this.idCounter,this.idCounter++,t)));break;case"update":if(i&&s)for(let t=0;t<this.playList.length;t++)if(this.playList[t].playId===i){const e={...this.playList[t],...s};return this.playList.splice(t,1,e)}break;case"reset":this._resetPlayList();break;default:this._resetPlayList()}}_cut(t){if(this.stop(),this._checkInit()&&"single-once"!==this.playModel){if(this.metaDataLoaded=!1,this.seekValue=null,this._setPlayIndex(),!this.playList[this.playIndex])return;const e=this.playList[this.playIndex].src;if(t)this.audioH5.src=e,this.load();else{this.unload();const t={...this.config,src:e};this._createAudio(t),this._registerEvent(t)}return this._fireEventQueue(this.playId,"oncut"),this.play(),this._setPlayState(d[1])}}_onEvent(t,e,i){-1!==p.indexOf(t)&&(this[t]||(this[t]={}),this[t][i||e.name||`anonymous-${(new Date).getTime()}`]=e)}_offEvent(t,e,i){-1!==p.indexOf(t)&&(e?(i||e.name)&&delete this[t][i||e.name]:this[t]=null)}_fireEventQueue(t,e){if(this[e])for(let i in this[e])this[e][i]&&this[e][i](t)}_registerEvent(t){const e=(t,e)=>i=>{if(this._triggerEventController(e))return t&&t(i)};Object.keys(t).forEach(e=>{if(0===e.indexOf("on")){const i=`EASE_AUDIO_${e.toUpperCase()}_INITIAL_CALLBACK`;this._onEvent(e,t[e],i)}}),this.eventMethods={loadstart:t=>{this.playState===d[1]&&this._setPlayState(d[0]),this._fireEventQueue(t,"onload")},playing:t=>{this._setPlayState(d[1]),this._fireEventQueue(t,"onplay")},canplaythrough:t=>{this.playState===d[0]&&this._setPlayState(d[1])},pause:t=>{this._setPlayState(d[2]),this._fireEventQueue(t,"onpause")},ended:t=>{this.isEnd?this.isEnd=!1:(this.isEnd=!0,this._fireEventQueue(t,"onend"),this.config.endAutoCut&&this._cut(!0))},error:t=>{this._setPlayState(d[5]),this._fireEventQueue(t,"onloaderror")},progress:t=>{const e=t.target.buffered,i=t.total||1;let s=0,n=t.loaded||0,a=n/i;if(e&&e.length){for(let t=0,i=e.length;t<i;t++)this.buffered.push({start:1e3*e.start(t),end:1e3*e.end(t)});s=1e3*(e.end(0)-e.start(0)),a=(n=Math.min(1,s/(1e3*t.target.duration)))/i}this._fireEventQueue({e:t,progress:a},"onprogress")},durationchange:t=>{},loadedmetadata:t=>{this.metaDataLoaded=!0,this.seekValue&&this.seek(this.seekValue)},loadeddata:t=>{},timeupdate:t=>{this.playState===d[0]&&(this._logInfo("timeupdate's playing"),this._setPlayState(d[1]),this._fireEventQueue(t,"onplay")),this.audioH5.duration&&+this.audioH5.currentTime>=+this.audioH5.duration&&(this._logInfo("timeupdate's ended"),this.isEnd?this.isEnd=!1:(this.isEnd=!0,this._fireEventQueue(t,"onend"),this.config.endAutoCut&&this._cut(!0))),this._fireEventQueue(t,"ontimeupdate")},canplay:t=>{this._fireEventQueue(t,"oncanplay")},seeking:t=>{this._fireEventQueue(t,"onseeking")},seeked:t=>{this._fireEventQueue(t,"onseeked")},play:t=>{},volumechange:t=>{this._fireEventQueue(t,"onvolume")},ratechange:t=>{this._fireEventQueue(t,"onrate")},abort:t=>{},suspend:t=>{}};for(let t in this.eventMethods)this.eventMethods[t]=e(this.eventMethods[t],t);for(let t in this.eventMethods)this._bindEvent(this.eventMethods[t],t);this._blockEvent({block:!1})}_unregisterEvent(){if(this._checkInit())for(let t in this.eventMethods)this._removeEvent(this.eventMethods[t],t)}_blockEvent({event:t,block:e}){if(this._checkInit())if(t&&this._checkType(t,"string"))this.eventController[t]=!e;else for(let t in this.eventMethods)this.eventController[t]=!e}_triggerEventController(t){return!!this.eventController[t]&&(this._log(`trigger ${t} event`),!0)}_bindEvent(t,e){if(!this._checkType(e,"string"))return this._logErr("bindEvent - bind event name is not string");this._checkType(t,"function",!0)&&h(e,t,this.audioH5)}_removeEvent(t,e){if(!this._checkType(e,"string"))return this._logErr("removeEvent - unbind event name is not string");this._checkType(t,"function",!0)&&r(e,t,this.audioH5)}_playLockQueue(t){return this.playLocker?this.lockQueue.push(t):t&&t()}_checkType(t,e,i){return"string"!=typeof e?this._logWarn("checkType - The type must be string"):l(t)===e||(i&&this._logErr(`Your parameter(${t}) type is ${l(t)}, please pass the ${e} type`),!1)}_checkInit(){return!!this.isInit||(this._logWarn("checkInit - The Audio haven't been initiated"),!1)}_log(t){return"silent"!==this.logLevel&&"detail"===this.logLevel&&this.debug&&console.log("[EASE_AUDIO_H5 DETAIL]:",t)}_logInfo(t){return"silent"!==this.logLevel&&"error"!==this.logLevel&&"warn"!==this.logLevel&&this.debug&&console.info("[EASE_AUDIO_H5 INFO]:",t)}_logWarn(t){return"silent"!==this.logLevel&&"error"!==this.logLevel&&this.debug&&console.warn("[EASE_AUDIO_H5 WARN]:",t)}_logErr(t){return"silent"!==this.logLevel&&this.debug&&console.error("[EASE_AUDIO_H5 ERROR]:",t)}};class _{constructor(t){this.audio=this._createAudio(t),this.init=this.audio.init,this.play=this.audio.play,this.pause=this.audio.pause,this.toggle=this.audio.toggle,this.cut=this.audio.cut,this.pick=this.audio.pick,this.load=this.audio.load,this.seek=this.audio.seek,this.volume=this.audio.volume,this.muted=this.audio.muted,this.stop=this.audio.stop,this.unload=this.audio.unload,this.on=this.audio.on,this.off=this.audio.off,this.once=this.audio.once,this.model=this.audio.model}get duration(){return this.audio.duration}get playState(){return this.audio.playState}get playId(){return this.audio.playId}get playingData(){return this.audio.playList[this.audio.playIndex]}set playlist(t){this.audio.playlist(t)}get playlist(){return this.audio.playList}get networkState(){return this.audio.networkState}_createAudio(t){let e={init:g,play:g,pause:g,toggle:g,load:g,seek:g,volume:g,muted:g,stop:g,unload:g,on:g,off:g,once:g};const{usingWebAudio:i}=t||{};try{i&&(window.AudioContext||window.webkitAudioContext)?e=new s(t):window.Audio&&(e=new f(t))}catch(t){console.error("[EASE_AUDIO ERROR]:",t)}return e}}function g(){return console.error("[EASE_AUDIO ERROR]: Initialize failed")}i.d(e,"EaseAudio",function(){return _});e.default=_}])});