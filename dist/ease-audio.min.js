!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.EaseAudio=e():t.EaseAudio=e()}(window,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=9)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}},function(t,e,i){var n=i(8);t.exports=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),o.forEach(function(e){n(t,e,i[e])})}return t}},function(t,e,i){var n=i(5),o=i(6),s=i(7);t.exports=function(t){return n(t)||o(t)||s()}},function(t,e){t.exports=function(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(t,e){t.exports=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}},function(t,e,i){"use strict";i.r(e);var n=i(0),o=i.n(n),s=i(1),a=i.n(s);var u=function(){function t(){o()(this,t),this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.audioDom=new window.Audio,this.audio=this.audioCtx.createMediaElementSource(this.audioDom)}return a()(t,[{key:"play",value:function(){}},{key:"pause",value:function(){}},{key:"stop",value:function(){}},{key:"unload",value:function(){}},{key:"seek",value:function(){}}]),t}(),r=i(3),l=i.n(r),h=i(2),c=i.n(h),d=i(4),p=i.n(d);var y=function(t){return!!t&&{edge:t.indexOf("Edge")>-1,trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&-1===t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile.*/)||!!t.match(/Mobile/g),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1,iPad:t.indexOf("iPad")>-1,webApp:-1===t.indexOf("Safari"),weixin:t.indexOf("MicroMessenger")>-1,weibo:t.indexOf("Weibo")>-1,facebook:t.indexOf("FBAN")>-1,twitter:t.indexOf("FBAN")>-1,qq:" qq"===t.match(/\sQQ/i),hmlyApp:/himalaya/i.test(t)}};let f;try{f=window&&window.navigator&&window.navigator.userAgent}catch(t){console.error("[isIE]: ".concat(t))}const v=!!f&&y(f).trident,k=(!!f&&y(f).edge,function(t){if("object"!=typeof t)return typeof t;const e=Object.prototype.toString.call(t).length-1;return Object.prototype.toString.call(t).slice(8,e).toLowerCase()}),_=["loading","playing","paused","stopped","ended","loaderror","playerror","unloaded"],g=["list-once","list-random","list-loop","single-once","single-loop"],b=["onplay","onpause","onstop","onend","onload","onunload","oncanplay","onprogress","onvolume","onseeking","onseeked","onrate","ontimeupdate","onloaderror","onplayerror","oncut","onpick"],m=["detail","info","warn","error","silent"],I="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA";var E=function(){function t(e){o()(this,t),this.isInit=!1,this.init=this.init.bind(this),this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.toggle=this.toggle.bind(this),this.cut=this.cut.bind(this),this.pick=this.pick.bind(this),this.load=this.load.bind(this),this.seek=this.seek.bind(this),this.rate=this.rate.bind(this),this.volume=this.volume.bind(this),this.muted=this.muted.bind(this),this.stop=this.stop.bind(this),this.unload=this.unload.bind(this),this.model=this.model.bind(this),this.on=this.on.bind(this),this.off=this.off.bind(this),this.once=this.once.bind(this),this.playlist=this.playlist.bind(this),this.init(e)}return a()(t,[{key:"init",value:function(t){if(!this.isInit&&t&&this._checkType(t,"object")&&"{}"!==JSON.stringify(t))return this._initial(t),this._registerEvent(t),this._returnParams()}},{key:"play",value:function(){var t=this;if(this._checkInit()){try{this._blockEvent({block:!1});let e=this.audioH5.play();if(e&&"undefined"!=typeof Promise&&(p()(e,Promise)||"function"==typeof e.then)&&(this.playLocker=!0,e.then(function(){t.lockQueue.forEach(function(t){return t&&t()}),t.lockQueue.splice(0),t.playLocker=!1}).catch(function(e){t.lockQueue.splice(0),t.playLocker=!1,t._setPlayState(_[6]),t._fireEventQueue(e,"onplayerror")})),this.audioH5.paused){const t="Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.";this._setPlayState(_[6]),this._fireEventQueue(t,"onplayerror")}}catch(t){this._setPlayState(_[6]),this._fireEventQueue(t,"onplayerror")}return this.playId}}},{key:"pause",value:function(){var t=this;if(this._checkInit())return this._playLockQueue(function(){return t.audioH5.pause()}),this.playId}},{key:"toggle",value:function(){if(this._checkInit()&&"stopped"!==this.playState&&"ended"!==this.playState&&"loaderror"!==this.playState&&"playerror"!==this.playState)return null===this.playState||"paused"===this.playState?this.play():this.pause(),this.playId}},{key:"cut",value:function(){if(this._checkInit())return this._cut(),this._returnParams()}},{key:"pick",value:function(t){if(this._checkInit()&&this._checkType(t,"number",!0)){for(let e=0;e<this.playList.length;e++)if(this.playList[e].playId===t){this.unload(!0),this._setPlayIndex(e);const t=this.playList[this.playIndex].src,i=c()({},this.config,{src:t});this._createAudio(i),this._registerEvent(i),this._fireEventQueue(this.playId,"onpick"),this.play();break}return this._returnParams()}}},{key:"load",value:function(){var t=this;if(this._checkInit())return this._playLockQueue(function(){return t.audioH5.load()}),this.playId}},{key:"seek",value:function(t){var e=this;if(this._checkInit()){if(!this._checkType(t,"number"))return this.audioH5.currentTime;{if(v&&!this.metaDataLoaded)return void(this.seekValue=t);const i=this.audioH5.duration;t>i&&(t=i),t<0&&(t=0),this.seekValue=null,this._playLockQueue(function(){return e.audioH5.currentTime=t})}}}},{key:"rate",value:function(t){var e=this;if(this._checkInit()){if(!this._checkType(t,"number"))return this.audioH5.playbackRate;t>2&&(t=2),t<.5&&(t=.5),this._playLockQueue(function(){return e.audioH5.playbackRate=t}),this._updateConfig({rate:t})}}},{key:"volume",value:function(t){var e=this;if(this._checkInit()){if(!this._checkType(t,"number"))return this.audioH5.volume;t>1&&(t=1),t<0&&(t=0),this._playLockQueue(function(){e.audioH5.muted=!1,e.audioH5.volume=t}),this._updateConfig({volume:t})}}},{key:"muted",value:function(t){var e=this;if(this._checkInit()){if(!this._checkType(t,"boolean",!0))return this.audioH5.muted;this._playLockQueue(function(){return e.audioH5.muted=t}),this._updateConfig({muted:t})}}},{key:"stop",value:function(t){var e=this;if(this._checkInit()&&this.playState!==_[3])return this._playLockQueue(function(){t||(e._blockEvent({block:!0}),e._setPlayState(_[3]),e._fireEventQueue(e.playId,"onstop")),e.audioH5.currentTime=0,e.audioH5.pause()}),this.playId}},{key:"unload",value:function(t){var e=this;this._checkInit()&&(this.stop(!0),this._unregisterEvent(),this._playLockQueue(function(){t||(e._setPlayState(_[7]),e._fireEventQueue(e.playId,"onunload")),e.audioH5.src=I,e.audioH5=null,e.isInit=!1}))}},{key:"model",value:function(t){if(this._checkInit()){if(-1===g.indexOf(t))return this.playModel;this.playModel=t}}},{key:"on",value:function(t,e){if(this._checkInit()&&this._checkType(t,"string",!0)&&this._checkType(e,"function",!0)){const i=0===t.indexOf("on")?t:"on".concat(t);this._onEvent(i,e)}}},{key:"off",value:function(t,e){if(this._checkInit()&&this._checkType(t,"string",!0)){const i=0===t.indexOf("on")?t:"on".concat(t);this._offEvent(i,e)}}},{key:"once",value:function(t,e){var i=this;if(this._checkInit()&&this._checkType(t,"string",!0)&&this._checkType(e,"function",!0)){const n=0===t.indexOf("on")?t:"on".concat(t),o="EASE_AUDIO_".concat(n.toUpperCase(),"_ONCE_CALLBACK"),s=function t(s){e&&e(s),i._offEvent(n,t,o)};this._onEvent(n,s,o)}}},{key:"playlist",value:function(t){const e=t.action,i=t.list,n=t.playId,o=t.params;if(this._checkInit()&&this._checkType(e,"string",!0)&&(!i||this._checkType(i,"array",!0))&&(!n||this._checkType(n,"number",!0))&&(!o||this._checkType(o,"object",!0)))return this._handlePlayList(t),this._returnParams()}},{key:"_initial",value:function(t){let e;if(this.config=t,this.playState=null,this.debug=t.debug||!1,this.logLevel=-1!==m.indexOf(t.logLevel)&&t.logLevel||m[3],this.idCounter=1e3,this.lockQueue=new Array(0),this.playLocker=!1,this.playId=1e3,this.playModel=-1!==g.indexOf(t.playModel)&&t.playModel||t.loop&&g[3]||g[0],this.playIndex=0,this.playList=new Array(0),this.buffered=new Array(0),this.eventController=new Array(0),this.eventMethods=Object.create(null),t.playlist&&this._checkType(t.playlist,"array")){for(let e=0;e<t.playlist.length;e++)this._checkType(t.playlist[e],"object")||(t.playlist[e]=Object.create(null,{src:{writable:!0,enumerable:!0,configurable:!0,value:t.playlist[e]}}));this._handlePlayList({action:"add",list:t.playlist}),(e=t.playlist[0]&&t.playlist[0].src)&&this._checkType(e,"string")||(e=I,this._logErr("The src property is necessary and must be string!"))}else this._logErr("Please pass correct playlist parameters!"),e=I;this._createAudio(c()({},t,{src:e}))}},{key:"_createAudio",value:function(t){this.isInit=!0,this.audioH5=new window.Audio,this.audioH5.autoplay=t.autoplay||!1,this.audioH5.loop=t.loop||!1,this.audioH5.src=this._srcAssemble(t.src),this.audioH5.preload=t.preload||!0,this.audioH5.volume=t.volume||(0===t.volume?0:1),this.audioH5.muted=t.muted||!1,this.audioH5.playbackRate=t.rate||t.playbackRate||1,this.audioH5.controls=!1}},{key:"_srcAssemble",value:function(t){return t&&this._checkType(t,"string")?t:I}},{key:"_updateConfig",value:function(t){this.config=c()({},this.config,t)}},{key:"_returnParams",value:function(){return{playId:this.playId,playingData:this.playList[this.playIndex],playlist:this.playList}}},{key:"_setPlayState",value:function(t){if(this._checkType(t,"string",!0)&&this.playState!==t){const e=this.audioH5.readyState>2,i=this.audioH5.paused,n=this.audioH5.ended,o=this.audioH5.seeking;switch(t){case _[0]:if(i||n||e)return!1;break;case _[1]:if(i||n||o||!e)return!1;break;case _[2]:if(n)return!1}return this._logInfo("setPlayState - ".concat(t)),this.playState=t,this.playState}}},{key:"_setPlayIndex",value:function(t){const e=this.playModel,i=this.playList.length-1;if(0===t)return this.playIndex=0,void(this.playId=this.playList[0]&&this.playList[0].playId||this.playId);switch(e){case"list-once":this.playIndex=t||(i>=this.playIndex?++this.playIndex:this.playIndex);break;case"list-random":this.playIndex=t||Math.round(Math.random()*i);break;case"list-loop":this.playIndex=t||(i>this.playIndex?++this.playIndex:0);break;case"single-once":case"single-loop":this.playIndex=t||this.playIndex;break;default:this.playIndex=t||this.playIndex}return this.playId=this.playList[this.playIndex]&&this.playList[this.playIndex].playId||this.playId,this._log("setPlayIndex - playIndex: ".concat(this.playIndex,"  playId: ").concat(this.playId)),this.playIndex}},{key:"_resetPlayList",value:function(){this.playList=[],this._setPlayIndex(0)}},{key:"_handlePlayList",value:function(t){var e=this;let i=t.action,n=t.list,o=t.playId,s=t.params;switch(i){case"add":this.playList=[].concat(l()(this.playList),l()(n.map(function(t){if(e._checkType(t,"object"))return t.playId=e.idCounter,e.idCounter++,t})));break;case"delete":if(o)for(let t=0;t<this.playList.length;t++)if(this.playList[t].playId===o)return this.playList.splice(t,1);break;case"insert":if(o&&n)for(let t=0;t<this.playList.length;t++){var a;if(this.playList[t].playId===o)return(a=this.playList).splice.apply(a,[t,0].concat(l()(n.map(function(t){return t.playId=e.idCounter,e.idCounter++,t}))))}break;case"replace":if(o&&n)for(let t=0;t<this.playList.length;t++){var u;if(this.playList[t].playId===o)return(u=this.playList).splice.apply(u,[t,1].concat(l()(n.map(function(t){return t.playId=e.idCounter,e.idCounter++,t}))))}break;case"update":if(o&&s)for(let t=0;t<this.playList.length;t++)if(this.playList[t].playId===o){const e=c()({},this.playList[t],s);return this.playList.splice(t,1,e)}break;case"reset":this._resetPlayList();break;default:this._resetPlayList()}}},{key:"_cut",value:function(t){if(this.stop(!0),this._checkInit()&&"single-once"!==this.playModel){if(this.metaDataLoaded=!1,this.seekValue=null,this._setPlayIndex(),!this.playList[this.playIndex])return;const e=this.playList[this.playIndex].src;if(t)this.audioH5.src=e,this.load();else{this.unload(!0);const t=c()({},this.config,{src:e});this._createAudio(t),this._registerEvent(t)}return this._fireEventQueue(this.playId,"oncut"),this.play(),this._setPlayState(_[1])}}},{key:"_onEvent",value:function(t,e,i){-1!==b.indexOf(t)&&(this[t]||(this[t]={}),this[t][i||e.name||"anonymous-".concat((new Date).getTime())]=e)}},{key:"_offEvent",value:function(t,e,i){-1!==b.indexOf(t)&&(e?(i||e.name)&&delete this[t][i||e.name]:this[t]=null)}},{key:"_fireEventQueue",value:function(t,e){if(this[e])for(let i in this[e])this[e][i]&&this[e][i](t)}},{key:"_registerEvent",value:function(t){var e=this;const i=function(t,i){return function(n){if(e._triggerEventController(i))return t&&t(n)}};Object.keys(t).forEach(function(i){if(0===i.indexOf("on")){const n="EASE_AUDIO_".concat(i.toUpperCase(),"_INITIAL_CALLBACK");e._onEvent(i,t[i],n)}}),this.eventMethods={loadstart:function(t){e.playState===_[1]&&e._setPlayState(_[0]),e._fireEventQueue(t,"onload")},playing:function(t){e._setPlayState(_[1]),e._fireEventQueue(t,"onplay")},canplaythrough:function(t){e.playState===_[0]&&e._setPlayState(_[1])},pause:function(t){e._setPlayState(_[2]),e._fireEventQueue(t,"onpause")},ended:function(t){e.isEnd?e.isEnd=!1:(e.isEnd=!0,e._fireEventQueue(t,"onend"),e.config.endAutoCut&&e._cut(!0))},error:function(t){e._setPlayState(_[5]),e._fireEventQueue(t,"onloaderror")},progress:function(t){const i=t.target.buffered,n=t.total||1;let o=0,s=t.loaded||0,a=s/n;if(i&&i.length){for(let t=0,n=i.length;t<n;t++)e.buffered.push({start:1e3*i.start(t),end:1e3*i.end(t)});o=1e3*(i.end(0)-i.start(0)),a=(s=Math.min(1,o/(1e3*t.target.duration)))/n}e._fireEventQueue({e:t,progress:a},"onprogress")},durationchange:function(t){},loadedmetadata:function(t){e.metaDataLoaded=!0,e.seekValue&&e.seek(e.seekValue)},loadeddata:function(t){},timeupdate:function(t){e.playState===_[0]&&(e._logInfo("timeupdate's playing"),e._setPlayState(_[1]),e._fireEventQueue(t,"onplay")),e.audioH5.duration&&+e.audioH5.currentTime>=+e.audioH5.duration&&(e._logInfo("timeupdate's ended"),e.isEnd?e.isEnd=!1:(e.isEnd=!0,e._fireEventQueue(t,"onend"),e.config.endAutoCut&&e._cut(!0))),e._fireEventQueue(t,"ontimeupdate")},canplay:function(t){e._fireEventQueue(t,"oncanplay")},seeking:function(t){e._fireEventQueue(t,"onseeking")},seeked:function(t){e._fireEventQueue(t,"onseeked")},play:function(t){},volumechange:function(t){e._fireEventQueue(t,"onvolume")},ratechange:function(t){e._fireEventQueue(t,"onrate")},abort:function(t){},suspend:function(t){}};for(let t in this.eventMethods)this.eventMethods[t]=i(this.eventMethods[t],t);for(let t in this.eventMethods)this._bindEvent(this.eventMethods[t],t);this._blockEvent({block:!1})}},{key:"_unregisterEvent",value:function(){if(this._checkInit())for(let t in this.eventMethods)this._removeEvent(this.eventMethods[t],t)}},{key:"_blockEvent",value:function(t){let e=t.event,i=t.block;if(this._checkInit())if(e&&this._checkType(e,"string"))this.eventController[e]=!i;else for(let t in this.eventMethods)this.eventController[t]=!i}},{key:"_triggerEventController",value:function(t){return!!this.eventController[t]&&(this._log("trigger ".concat(t," event")),!0)}},{key:"_bindEvent",value:function(t,e){if(!this._checkType(e,"string"))return this._logErr("bindEvent - bind event name is not string");this._checkType(t,"function",!0)&&function(t,e,i){if(!window)return!1;const n=i||window;window.addEventListener?n.addEventListener(t,e,!1):n.attachEvent("on".concat(t),e)}(e,t,this.audioH5)}},{key:"_removeEvent",value:function(t,e){if(!this._checkType(e,"string"))return this._logErr("removeEvent - unbind event name is not string");this._checkType(t,"function",!0)&&function(t,e,i){if(!window)return!1;const n=i||window;window.removeEventListener?n.removeEventListener(t,e,!1):n.detachEvent("on".concat(t),e)}(e,t,this.audioH5)}},{key:"_playLockQueue",value:function(t){return this.playLocker?this.lockQueue.push(t):t&&t()}},{key:"_checkType",value:function(t,e,i){return"string"!=typeof e?this._logWarn("checkType - The type must be string"):k(t)===e||(i&&this._logErr("Your parameter(".concat(t,") type is ").concat(k(t),", please pass the ").concat(e," type")),!1)}},{key:"_checkInit",value:function(){return!!this.isInit||(this._logWarn("checkInit - The Audio haven't been initiated"),!1)}},{key:"_log",value:function(t){return"silent"!==this.logLevel&&"detail"===this.logLevel&&this.debug&&console.log("[EASE_AUDIO_H5 DETAIL]:",t)}},{key:"_logInfo",value:function(t){return"silent"!==this.logLevel&&"error"!==this.logLevel&&"warn"!==this.logLevel&&this.debug&&console.info("[EASE_AUDIO_H5 INFO]:",t)}},{key:"_logWarn",value:function(t){return"silent"!==this.logLevel&&"error"!==this.logLevel&&this.debug&&console.warn("[EASE_AUDIO_H5 WARN]:",t)}},{key:"_logErr",value:function(t){return"silent"!==this.logLevel&&this.debug&&console.error("[EASE_AUDIO_H5 ERROR]:",t)}},{key:"duration",get:function(){return this.audioH5.duration}},{key:"setProps",set:function(t){let e=t.prop,i=t.value;this.audioH5[e]&&!this._checkType(this.audioH5[e],"function")&&(this.audioH5[e]=i,this._updateConfig({prop:i}))}}]),t}();let A=function(){function t(e){var i=this;o()(this,t),this.audio=this._createAudio(e),this.init=this.audio.init,this.play=this.audio.play,this.pause=this.audio.pause,this.toggle=this.audio.toggle,this.cut=this.audio.cut,this.pick=this.audio.pick,this.load=this.audio.load,this.seek=this.audio.seek,this.volume=this.audio.volume,this.muted=this.audio.muted,this.stop=function(){return i.audio.stop()},this.unload=function(){return i.audio.unload()},this.on=this.audio.on,this.off=this.audio.off,this.once=this.audio.once,this.model=this.audio.model}return a()(t,[{key:"_createAudio",value:function(t){let e={init:x,play:x,pause:x,toggle:x,load:x,seek:x,volume:x,muted:x,stop:x,unload:x,on:x,off:x,once:x};const i=(t||{}).usingWebAudio;try{i&&(window.AudioContext||window.webkitAudioContext)?e=new u(t):window.Audio&&(e=new E(t))}catch(t){console.error("[EASE_AUDIO ERROR]:",t)}return e}},{key:"duration",get:function(){return this.audio.duration}},{key:"playState",get:function(){return this.audio.playState}},{key:"playId",get:function(){return this.audio.playId}},{key:"playingData",get:function(){return this.audio.playList[this.audio.playIndex]}},{key:"playlist",set:function(t){this.audio.playlist(t)},get:function(){return this.audio.playList}},{key:"networkState",get:function(){return this.audio.networkState}}]),t}();function x(){return console.error("[EASE_AUDIO ERROR]: Initialize failed")}i.d(e,"EaseAudio",function(){return A});e.default=A}])});